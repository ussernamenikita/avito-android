<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="This page contains Avito specific details  Test case in code #  Avito uses in-house TMS: Internal docs
TMS was a source of truth about test cases in avito since the very early days.
While company shifted to test automation, manual synchronization between test cases in TMS and code in autotests became a problem.\
To simplify this process &ldquo;test cases in code&rdquo; concept was born.
Now only code contains truth about test cases, and automated ones are read-only in TMS."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Test case in code"><meta property="og:description" content="This page contains Avito specific details  Test case in code #  Avito uses in-house TMS: Internal docs
TMS was a source of truth about test cases in avito since the very early days.
While company shifted to test automation, manual synchronization between test cases in TMS and code in autotests became a problem.\
To simplify this process &ldquo;test cases in code&rdquo; concept was born.
Now only code contains truth about test cases, and automated ones are read-only in TMS."><meta property="og:type" content="article"><meta property="og:url" content="https://avito-tech.github.io/avito-android/docs/test/testcaseincode/"><title>Test case in code | Avito Android</title><link rel=manifest href=/avito-android/manifest.json><link rel=icon href=/avito-android/favicon.png type=image/x-icon><link rel=stylesheet href=/avito-android/book.min.6cd8553a6854f4812343f0f0c8baca31271e686434f381fbe3c7226f66639176.css integrity="sha256-bNhVOmhU9IEjQ/DwyLrKMSceaGQ084H748cib2ZjkXY="><script defer src=/avito-android/en.search.min.20e16256335d934d0842f7d7f78ee597f1f12cb101008d4cb6d92f042bb43baf.js integrity="sha256-IOFiVjNdk00IQvfX947ll/HxLLEBAI1MttkvBCu0O68="></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-157613383-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script defer src=https://unpkg.com/clipboard@2/dist/clipboard.min.js></script><style>div.no-highlight,div.highlight{position:relative}.copy-code-button{transition:opacity .3s ease-in-out;background-repeat:no-repeat;background-color:transparent;opacity:.2;padding:2px 4px;position:absolute;right:4px;top:4px;border:none;outline:none;overflow:hidden}.copy-code-button svg{filter:invert(30%)}div.no-highlight:hover .copy-code-button,div.no-highlight:hover .copy-code-button:focus{opacity:1;filter:invert(0%)}div.highlight:hover .copy-code-button,div.highlight:hover .copy-code-button:focus{opacity:1;filter:invert(100%)}div.highlight:hover .copy-code-button:hover,div.no-highlight:hover .copy-code-button:hover{opacity:1;filter:invert(20%)sepia(85%)saturate(2162%)hue-rotate(201deg)brightness(100%)contrast(91%)}</style><script>window.addEventListener("load",function(){if(!ClipboardJS.isSupported()){console.warn("ClipboardJS is not supported")
return}
function wrap(element,wrapper){element.parentNode.insertBefore(wrapper,element);wrapper.appendChild(element);}
document.querySelectorAll('pre > code').forEach(function(codeBlock){var button=document.createElement('button');button.className='copy-code-button';button.type='button';button.title='Copy'
var buttonImage=document.createElement('svg');buttonImage.setAttribute('viewBox','0 0 24 24')
buttonImage.innerHTML='\u003csvg xmlns=\u0022http:\/\/www.w3.org\/2000\/svg\u0022 width=\u002224\u0022 height=\u002224\u0022 viewBox=\u00220 0 24 24\u0022\u003e\n    \u003cpath d=\u0022M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\u0022\u003e\u003c\/path\u003e\n\u003c\/svg\u003e\n'
buttonImage.class='copy'
button.appendChild(buttonImage)
var pre=codeBlock.parentNode;if(pre.parentNode.classList.contains('highlight')){var highlight=pre.parentNode;highlight.insertBefore(button,pre);}else{var wrapper=document.createElement('div');wrapper.className='no-highlight';wrap(pre,wrapper)
wrapper.insertBefore(button,pre);}});var clipboard=new ClipboardJS('.copy-code-button',{target:function(trigger){return trigger.nextElementSibling;}});clipboard.on('success',function(e){e.clearSelection();});clipboard.on('error',function(e){console.error('Error during copying:',e.action);});});</script></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/avito-android><span>Avito Android</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://avito-tech.github.io/avito-android/>Introduction</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/tech_radar/techradar/>Tech radar</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/knownissues/>Known Issues</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/contacts/>Contacts</a></li><li>Projects<ul><li><a href=https://avito-tech.github.io/avito-android/docs/projects/buildchecks/>Build checks</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/projects/buildproperties/>Build properties</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/projects/buildtrace/>Build trace</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/projects/cisteps/>CI Steps</a></li></ul></li><li>Contributing<ul><li><a href=https://avito-tech.github.io/avito-android/docs/contributing/howtostart/>How to start</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/contributing/docs/>Documentation</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/contributing/codereview/>Code Review</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/contributing/codestyle/>Code Style</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/contributing/featuretoggles/>Feature Toggles</a></li></ul></li><li>IDE<ul><li><a href=https://avito-tech.github.io/avito-android/docs/ide/configurations/>Конфигурации</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/ide/templates/>Шаблоны</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/ide/speedup/>Speedup</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/ide/benchmarking/>Бенчмарки</a></li></ul></li><li>Builds<ul><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/buildtypes/>Типы сборки</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/dependencies/>Dependencies</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/minimization/>Минимизация</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/benchmarks/>Бенчмарки</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/profiling/>Профилирование</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/buildmetrics/>Метрики</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/mirakle/>Mirakle</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/troubleshooting/>Troubleshooting</a></li></ul></li><li>Architecture<ul><li><a href=https://avito-tech.github.io/avito-android/docs/architecture/dagger/>Dagger</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/architecture/modules/>Modules</a></li></ul></li><li><a href=https://avito-tech.github.io/avito-android/docs/analytics/analytics/>Аналитика</a><ul><li><a href=https://avito-tech.github.io/avito-android/docs/analytics/statsd/>Statsd</a></li></ul></li><li>Testing<ul><li><a href=https://avito-tech.github.io/avito-android/docs/test/run/>Запуск тестов</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/runner/>Test Runner</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/manual/>Ручное</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/testcaseincode/>Test case in code</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/unittesting/>Юнит тесты</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/screenshottesting/>Скриншотные тесты</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/testminimized/>Test minimized</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/reportviewer/>Report Viewer</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/troubleshootingui/>Troubleshooting</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/workmanager/>Work Manager Testing</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/flakyannotation/>Flaky annotation</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/flakytests/>Нестабильные тесты</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/toast/>Toast</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/snackbar/>Snackbar</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/screenchecks/>Screen checks</a></li></ul></li><li><a href=https://avito-tech.github.io/avito-android/docs/test_framework/testframework/>Test framework</a><ul><li><a href=https://avito-tech.github.io/avito-android/docs/test_framework/mocking/>Mocking</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test_framework/internals/>Internals</a></li></ul></li><li><a href=http://links.k.avito.ru/ff>Design System</a></li><li>Performance<ul><li><a href=https://avito-tech.github.io/avito-android/docs/performance/analytics/>Аналитика</a></li></ul></li><li>Checks<ul><li><a href=https://avito-tech.github.io/avito-android/docs/checks/androidlint/>Android lint</a></li></ul></li><li>CI<ul><li><a href=https://avito-tech.github.io/avito-android/docs/ci/civalues/>Требования</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/projects/cisteps/>CI Gradle Plugin</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/ci/customgradleplugins/>Custom Gradle Plugins</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/ci/impactanalysis/>Impact analysis</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/ci/containers/>Containers</a></li></ul></li><li>CD<ul><li><a href=https://avito-tech.github.io/avito-android/docs/cd/release/>Релиз</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/cd/artifacts/>Артефакты сборки</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/cd/qapps/>QApps</a></li></ul></li><li><a href=https://avito-tech.github.io/avito-android/docs/release/>Infra Release</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/infrastructure/>Infrastructure (Github project)</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/externallibrarychangeprocess/>Внешние библиотеки</a></li></ul><ul><li><a href=/avito-android/posts/>Blog</a></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/avito-android/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Test case in code</strong>
<label for=toc-control><img src=/avito-android/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#how-to-synchronize-your-test-with-tms>How to synchronize your test with TMS?</a><ul><li><a href=#kind>Kind</a></li></ul></li><li><a href=#when-will-my-tests-appear-in-tms>When will my tests appear in TMS?</a></li><li><a href=#how-to-find-out-why-a-test-was-not-synced>How to find out why a test was not synced</a></li><li><a href=#stubs-tests-without-implementation>Stubs: tests without implementation</a><ul><li><a href=#how-to-generate-a-stub-test>How to generate a stub test</a></li></ul></li><li><a href=#how-synchronization-works>How synchronization works</a></li><li><a href=#tms-gradle-plugin>TMS Gradle plugin</a></li><li><a href=#how-to-troubleshoot-sync-issues>How to troubleshoot sync issues?</a></li></ul></nav></aside></header><article class=markdown><blockquote class="book-hint info">This page contains Avito specific details</blockquote><h1 id=test-case-in-code>Test case in code
<a class=anchor href=#test-case-in-code>#</a></h1><p>Avito uses in-house TMS: <a href=http://links.k.avito.ru/h>Internal docs</a></p><p>TMS was a source of truth about test cases in avito since the very early days.<br>While company shifted to test automation, manual synchronization between test cases in TMS and code in autotests became a problem.\</p><p>To simplify this process &ldquo;test cases in code&rdquo; concept was born.<br>Now only code contains truth about test cases, and automated ones are read-only in TMS.</p><h2 id=how-to-synchronize-your-test-with-tms>How to synchronize your test with TMS?
<a class=anchor href=#how-to-synchronize-your-test-with-tms>#</a></h2><p>Test should have this minimal set of annotations:</p><ul><li><code>@ExternalId(UUID)</code> UUID - random generated uuid (use any tool, for example online generator)</li><li><code>@Description</code> - testcase title</li><li><code>@FeatureId(IntArray)</code> - specify test&rsquo;s place in global features tree</li><li><code>@TagId(IntArray)</code> - specify id&rsquo;s of team tag cloud</li><li><a href=#kind>Kind</a></li></ul><p>&ndash; deprecated &ndash;</p><ul><li><code>@CaseId(Int)</code> - TMS id, consider using <a href=#test-case-in-code>test case in code</a></li></ul><h3 id=kind>Kind
<a class=anchor href=#kind>#</a></h3><p>Kind has to be specified to map tests on test pyramid in TMS, see <code>com.avito.report.model.Kind</code></p><p>These annotations also used to filter tests for different suites.</p><ul><li>@E2ETest - e2e functional tests</li><li>@UIComponentTest - UI tests without(or minimal) e2e networking</li><li>@IntegrationTest - Instrumentation tests without UI</li><li>@UnitTest - Classical unit tests that should be synced with TMS</li><li><a href=#stubs-tests-without-implementation>@ManualTest</a></li><li><a href=#stubs-tests-without-implementation>@UIComponentStub</a></li><li><a href=#stubs-tests-without-implementation>@E2EStub</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/screenshottesting/>@ScreenshotTest</a></li></ul><h2 id=when-will-my-tests-appear-in-tms>When will my tests appear in TMS?
<a class=anchor href=#when-will-my-tests-appear-in-tms>#</a></h2><p>After test with required annotations merged, next full suite test run will trigger sync process.</p><p><a href=http://links.k.avito.ru/androidnightly>Internal Teamcity configuration</a></p><p>This build runs every night, and it is recommended not to run this build manually only to sync a bunch of tests, because it&rsquo;s fairly heavy.</p><h2 id=how-to-find-out-why-a-test-was-not-synced>How to find out why a test was not synced
<a class=anchor href=#how-to-find-out-why-a-test-was-not-synced>#</a></h2><p><a href=https://avito-tech.github.io/avito-android/docs/contacts/>Let us know</a> if something seems to go wrong.</p><p>Please attach:</p><ul><li>your pull request link</li><li>nightly build that should trigger sync link</li><li>test case id link in TMS (if it was edited, not a new one)</li></ul><h2 id=stubs-tests-without-implementation>Stubs: tests without implementation
<a class=anchor href=#stubs-tests-without-implementation>#</a></h2><p>If you need to sync tests, but you&rsquo;re not ready to automate it, there is a way: stubs.<br>Stubs are tests with all needed meta information (annotations, steps), but without actual implementation and asserts.</p><p>To differentiate stubs from regular tests additional kind annotations were added.<br>Kind <code>Manual</code> are a special one, to express intention that there are no plans to automate this case.</p><h3 id=how-to-generate-a-stub-test>How to generate a stub test
<a class=anchor href=#how-to-generate-a-stub-test>#</a></h3><p>To get help with moving test cases, check internal module&rsquo;s <code>:test:generator</code> readme.<br>This project will generate test stubs from TMS id&rsquo;s.</p><h2 id=how-synchronization-works>How synchronization works
<a class=anchor href=#how-synchronization-works>#</a></h2><script defer src=https://unpkg.com/mermaid@8.8.2/dist/mermaid.min.js type=text/javascript></script><script>mermaid.initialize({flowchart:{useMaxWidth:true}});</script><p class=mermaid>sequenceDiagram
InstrumentationPlugin->>ReportService: addTest() X times for whole suite
InstrumentationPlugin->>ReportService: setFinished()
ReportService->>TmsEventProcessor: event
loop analyze
TmsEventProcessor->>TmsEventProcessor: just regular test run, skip
end
TmsPlugin->>ReportService: pushPreparedData(<this is source of truth with timestamp>)
TmsPlugin->>ReportService: setFinished()
ReportService->>TmsEventProcessor: event
loop analyze
TmsEventProcessor->>TmsEventProcessor: contains fresh(newest date) source of truth
end
loop analyze
TmsEventProcessor->>TmsEventProcessor: parse report and prepare payload for TMS
end
TmsEventProcessor->>TMS: sendModifiedTestSuite()</p><h2 id=tms-gradle-plugin>TMS Gradle plugin
<a class=anchor href=#tms-gradle-plugin>#</a></h2><p>Project should apply and configure the plugin:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>plugins {
    id(<span style=color:#e6db74>&#34;com.avito.android.tms&#34;</span>)
}

tms {
    reportsHost.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;&lt;report viewer host&gt;&#34;</span>)
}
</code></pre></div><p>And also add a <a href=https://avito-tech.github.io/avito-android/docs/projects/cisteps/>CI step</a></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>builds {
    release {  <span style=color:#75715e>// build that contains full test suite
</span><span style=color:#75715e></span>        markReportAsSourceForTMS {
            configuration = <span style=color:#e6db74>&#34;ui&#34;</span> <span style=color:#75715e>// instrumentation configuration to wait for
</span><span style=color:#75715e></span>        }
    }
}
</code></pre></div><h2 id=how-to-troubleshoot-sync-issues>How to troubleshoot sync issues?
<a class=anchor href=#how-to-troubleshoot-sync-issues>#</a></h2><blockquote class="book-hint info">Nightly build could be skipped if there are no code changes, keep it in mind while troubleshooting.</blockquote><ul><li>Nightly build log should contain line:
<code>[TMS] Test suite for tms version &lt;timestamp>, with id: &lt;id>, coordinates: &lt;reportCoordinates> marked as source of truth for tms</code></li><li>Check <code>[TMS]</code> tag in log for possible errors</li><li>Check slack alerts channel: <a href=http://links.k.avito.ru/tmsalerts>#tms-validation-errors</a></li><li>Look at TMS sync service metrics:<ul><li><a href=http://links.k.avito.ru/androidtmscount>Test case count</a> (check <code>aa/avito-android.total</code>)</li><li><a href=http://links.k.avito.ru/androidtmsevents>Create/Delete events</a> (check <code>aa/avito-android.created</code> and <code>aa/avito-android.deleted</code>)</li></ul></li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div class=book-languages tabindex=0 aria-haspopup=true><ul><li class="flex align-center"><img src=/avito-android/svg/translate.svg class=book-icon alt=Languages>
English</li></ul><ul class=book-languages-list><li class=active><a href=https://avito-tech.github.io/avito-android/ class="flex align-center"><img src=/avito-android/svg/translate.svg class=book-icon alt=Languages>
English</a></li><li><a href=https://avito-tech.github.io/avito-android/ru/ class="flex align-center"><img src=/avito-android/svg/translate.svg class=book-icon alt=Languages>
Русский</a></li></ul></div><div><a class="flex align-center" href=https://github.com/avito-tech/avito-android/tree/develop/docs/content//docs/test/TestCaseInCode.md target=_blank rel=noopener><img src=/avito-android/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#how-to-synchronize-your-test-with-tms>How to synchronize your test with TMS?</a><ul><li><a href=#kind>Kind</a></li></ul></li><li><a href=#when-will-my-tests-appear-in-tms>When will my tests appear in TMS?</a></li><li><a href=#how-to-find-out-why-a-test-was-not-synced>How to find out why a test was not synced</a></li><li><a href=#stubs-tests-without-implementation>Stubs: tests without implementation</a><ul><li><a href=#how-to-generate-a-stub-test>How to generate a stub test</a></li></ul></li><li><a href=#how-synchronization-works>How synchronization works</a></li><li><a href=#tms-gradle-plugin>TMS Gradle plugin</a></li><li><a href=#how-to-troubleshoot-sync-issues>How to troubleshoot sync issues?</a></li></ul></nav></aside></main></body></html>