<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Build checks Gradle plugin #  This plugin verifies common build problems with environment and project configuration.
Getting started #  Apply the plugin in the root build script:
plugins { id(&#34;com.avito.android.buildchecks&#34;) } In the settings.gradle:
pluginManagement { repositories { maven { name = &#34;Avito bintray&#34; url = &#34;https://dl.bintray.com/avito/maven&#34; } } resolutionStrategy { eachPlugin { String pluginId = requested.id.id if (pluginId.startsWith(&#34;com.avito.android&#34;)) { def artifact = pluginId.replace(&#34;com.avito.android.&#34;, &#34;&#34;) useModule(&#34;com.avito.android:$artifact:$avitoToolsVersion&#34;) } } } } avitoToolsVersion could be exact version, or property in project&rsquo;s gradle."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Build checks Gradle plugin"><meta property="og:description" content="Build checks Gradle plugin #  This plugin verifies common build problems with environment and project configuration.
Getting started #  Apply the plugin in the root build script:
plugins { id(&#34;com.avito.android.buildchecks&#34;) } In the settings.gradle:
pluginManagement { repositories { maven { name = &#34;Avito bintray&#34; url = &#34;https://dl.bintray.com/avito/maven&#34; } } resolutionStrategy { eachPlugin { String pluginId = requested.id.id if (pluginId.startsWith(&#34;com.avito.android&#34;)) { def artifact = pluginId.replace(&#34;com.avito.android.&#34;, &#34;&#34;) useModule(&#34;com.avito.android:$artifact:$avitoToolsVersion&#34;) } } } } avitoToolsVersion could be exact version, or property in project&rsquo;s gradle."><meta property="og:type" content="article"><meta property="og:url" content="https://avito-tech.github.io/avito-android/docs/projects/buildchecks/"><title>Build checks Gradle plugin | Avito Android</title><link rel=manifest href=/avito-android/manifest.json><link rel=icon href=/avito-android/favicon.png type=image/x-icon><link rel=stylesheet href=/avito-android/book.min.6cd8553a6854f4812343f0f0c8baca31271e686434f381fbe3c7226f66639176.css integrity="sha256-bNhVOmhU9IEjQ/DwyLrKMSceaGQ084H748cib2ZjkXY="><script defer src=/avito-android/en.search.min.20e16256335d934d0842f7d7f78ee597f1f12cb101008d4cb6d92f042bb43baf.js integrity="sha256-IOFiVjNdk00IQvfX947ll/HxLLEBAI1MttkvBCu0O68="></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-157613383-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script defer src=https://unpkg.com/clipboard@2/dist/clipboard.min.js></script><style>div.no-highlight,div.highlight{position:relative}.copy-code-button{transition:opacity .3s ease-in-out;background-repeat:no-repeat;background-color:transparent;opacity:.2;padding:2px 4px;position:absolute;right:4px;top:4px;border:none;outline:none;overflow:hidden}.copy-code-button svg{filter:invert(30%)}div.no-highlight:hover .copy-code-button,div.no-highlight:hover .copy-code-button:focus{opacity:1;filter:invert(0%)}div.highlight:hover .copy-code-button,div.highlight:hover .copy-code-button:focus{opacity:1;filter:invert(100%)}div.highlight:hover .copy-code-button:hover,div.no-highlight:hover .copy-code-button:hover{opacity:1;filter:invert(20%)sepia(85%)saturate(2162%)hue-rotate(201deg)brightness(100%)contrast(91%)}</style><script>window.addEventListener("load",function(){if(!ClipboardJS.isSupported()){console.warn("ClipboardJS is not supported")
return}
function wrap(element,wrapper){element.parentNode.insertBefore(wrapper,element);wrapper.appendChild(element);}
document.querySelectorAll('pre > code').forEach(function(codeBlock){var button=document.createElement('button');button.className='copy-code-button';button.type='button';button.title='Copy'
var buttonImage=document.createElement('svg');buttonImage.setAttribute('viewBox','0 0 24 24')
buttonImage.innerHTML='\u003csvg xmlns=\u0022http:\/\/www.w3.org\/2000\/svg\u0022 width=\u002224\u0022 height=\u002224\u0022 viewBox=\u00220 0 24 24\u0022\u003e\n    \u003cpath d=\u0022M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\u0022\u003e\u003c\/path\u003e\n\u003c\/svg\u003e\n'
buttonImage.class='copy'
button.appendChild(buttonImage)
var pre=codeBlock.parentNode;if(pre.parentNode.classList.contains('highlight')){var highlight=pre.parentNode;highlight.insertBefore(button,pre);}else{var wrapper=document.createElement('div');wrapper.className='no-highlight';wrap(pre,wrapper)
wrapper.insertBefore(button,pre);}});var clipboard=new ClipboardJS('.copy-code-button',{target:function(trigger){return trigger.nextElementSibling;}});clipboard.on('success',function(e){e.clearSelection();});clipboard.on('error',function(e){console.error('Error during copying:',e.action);});});</script></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/avito-android><span>Avito Android</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://avito-tech.github.io/avito-android/>Introduction</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/tech_radar/techradar/>Tech radar</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/knownissues/>Known Issues</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/contacts/>Contacts</a></li><li>Projects<ul><li><a href=https://avito-tech.github.io/avito-android/docs/projects/buildchecks/>Build checks</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/projects/buildproperties/>Build properties</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/projects/buildtrace/>Build trace</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/projects/cisteps/>CI Steps</a></li></ul></li><li>Contributing<ul><li><a href=https://avito-tech.github.io/avito-android/docs/contributing/howtostart/>How to start</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/contributing/docs/>Documentation</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/contributing/codereview/>Code Review</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/contributing/codestyle/>Code Style</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/contributing/featuretoggles/>Feature Toggles</a></li></ul></li><li>IDE<ul><li><a href=https://avito-tech.github.io/avito-android/docs/ide/configurations/>Конфигурации</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/ide/templates/>Шаблоны</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/ide/speedup/>Speedup</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/ide/benchmarking/>Бенчмарки</a></li></ul></li><li>Builds<ul><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/buildtypes/>Типы сборки</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/dependencies/>Dependencies</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/minimization/>Минимизация</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/benchmarks/>Бенчмарки</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/profiling/>Профилирование</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/buildmetrics/>Метрики</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/mirakle/>Mirakle</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/troubleshooting/>Troubleshooting</a></li></ul></li><li>Architecture<ul><li><a href=https://avito-tech.github.io/avito-android/docs/architecture/dagger/>Dagger</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/architecture/modules/>Modules</a></li></ul></li><li><a href=https://avito-tech.github.io/avito-android/docs/analytics/analytics/>Аналитика</a><ul><li><a href=https://avito-tech.github.io/avito-android/docs/analytics/statsd/>Statsd</a></li></ul></li><li>Testing<ul><li><a href=https://avito-tech.github.io/avito-android/docs/test/run/>Запуск тестов</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/runner/>Test Runner</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/manual/>Ручное</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/testcaseincode/>Test case in code</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/unittesting/>Юнит тесты</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/screenshottesting/>Скриншотные тесты</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/testminimized/>Test minimized</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/reportviewer/>Report Viewer</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/troubleshootingui/>Troubleshooting</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/workmanager/>Work Manager Testing</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/flakyannotation/>Flaky annotation</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/flakytests/>Нестабильные тесты</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/toast/>Toast</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/snackbar/>Snackbar</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/screenchecks/>Screen checks</a></li></ul></li><li><a href=https://avito-tech.github.io/avito-android/docs/test_framework/testframework/>Test framework</a><ul><li><a href=https://avito-tech.github.io/avito-android/docs/test_framework/mocking/>Mocking</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test_framework/internals/>Internals</a></li></ul></li><li><a href=http://links.k.avito.ru/ff>Design System</a></li><li>Performance<ul><li><a href=https://avito-tech.github.io/avito-android/docs/performance/analytics/>Аналитика</a></li></ul></li><li>Checks<ul><li><a href=https://avito-tech.github.io/avito-android/docs/checks/androidlint/>Android lint</a></li></ul></li><li>CI<ul><li><a href=https://avito-tech.github.io/avito-android/docs/ci/civalues/>Требования</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/projects/cisteps/>CI Gradle Plugin</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/ci/customgradleplugins/>Custom Gradle Plugins</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/ci/impactanalysis/>Impact analysis</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/ci/containers/>Containers</a></li></ul></li><li>CD<ul><li><a href=https://avito-tech.github.io/avito-android/docs/cd/release/>Релиз</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/cd/artifacts/>Артефакты сборки</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/cd/qapps/>QApps</a></li></ul></li><li><a href=https://avito-tech.github.io/avito-android/docs/release/>Infra Release</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/infrastructure/>Infrastructure (Github project)</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/externallibrarychangeprocess/>Внешние библиотеки</a></li></ul><ul><li><a href=/avito-android/posts/>Blog</a></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/avito-android/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Build checks Gradle plugin</strong>
<label for=toc-control><img src=/avito-android/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#getting-started>Getting started</a></li><li><a href=#configuration>Configuration</a><ul><li><a href=#enable-single-check>Enable single check</a></li><li><a href=#disable-single-check>Disable single check</a></li><li><a href=#disable-all-checks>Disable all checks</a></li><li><a href=#disable-plugin>Disable plugin</a></li></ul></li><li><a href=#checks>Checks</a><ul><li><a href=#java-version>Java version</a></li><li><a href=#android-sdk-version>Android SDK version</a></li><li><a href=#macos-localhost-lookup>macOS localhost lookup</a></li><li><a href=#dynamic-dependency-version>Dynamic dependency version</a></li><li><a href=#unique-r-classes>Unique R classes</a></li><li><a href=#gradle-daemon-reusage>Gradle daemon reusage</a></li><li><a href=#module-types>Module types</a></li><li><a href=#gradle-properties>Gradle properties</a></li><li><a href=#incremental-kapt>Incremental KAPT</a><ul><li><a href=#room>Room</a></li></ul></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=build-checks-gradle-plugin>Build checks Gradle plugin
<a class=anchor href=#build-checks-gradle-plugin>#</a></h1><p>This plugin verifies <a href=#checks>common build problems</a> with environment and project configuration.</p><h2 id=getting-started>Getting started
<a class=anchor href=#getting-started>#</a></h2><p>Apply the plugin in the root build script:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>plugins <span style=color:#f92672>{</span>
    id<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;com.avito.android.buildchecks&#34;</span><span style=color:#f92672>)</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>In the <code>settings.gradle</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>pluginManagement <span style=color:#f92672>{</span>
    repositories <span style=color:#f92672>{</span>
        maven <span style=color:#f92672>{</span>
            name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Avito bintray&#34;</span>
            url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://dl.bintray.com/avito/maven&#34;</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>
    resolutionStrategy <span style=color:#f92672>{</span>
        eachPlugin <span style=color:#f92672>{</span>
            String pluginId <span style=color:#f92672>=</span> requested<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>id</span>
            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>pluginId<span style=color:#f92672>.</span><span style=color:#a6e22e>startsWith</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;com.avito.android&#34;</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
                <span style=color:#66d9ef>def</span> artifact <span style=color:#f92672>=</span> pluginId<span style=color:#f92672>.</span><span style=color:#a6e22e>replace</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;com.avito.android.&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>)</span>
                useModule<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;com.avito.android:$artifact:$avitoToolsVersion&#34;</span><span style=color:#f92672>)</span>
            <span style=color:#f92672>}</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p><code>avitoToolsVersion</code> could be exact version, or property in project&rsquo;s <code>gradle.properties</code>.<br>The latest version could be found on project&rsquo;s <a href=https://github.com/avito-tech/avito-android/releases>release page</a>.</p><div class=book-tabs><input type=radio class=toggle name="tabs-build checks example" id="tabs-build checks example-0" checked>
<label for="tabs-build checks example-0">Kotlin</label><div class="book-tabs-content markdown-inner"><p><code>build.gradle.kts</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>buildChecks {
    androidSdk {
        compileSdkVersion = <span style=color:#ae81ff>29</span>
        revision = <span style=color:#ae81ff>5</span>
    }
    javaVersion {
        version = JavaVersion.VERSION_1_8
    }
    uniqueRClasses {
        enabled = <span style=color:#66d9ef>false</span>
    }
}
</code></pre></div></div><input type=radio class=toggle name="tabs-build checks example" id="tabs-build checks example-1">
<label for="tabs-build checks example-1">Groovy</label><div class="book-tabs-content markdown-inner"><p><code>build.gradle</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>buildChecks <span style=color:#f92672>{</span>
    androidSdk <span style=color:#f92672>{</span>
        compileSdkVersion <span style=color:#f92672>=</span> <span style=color:#ae81ff>29</span>
        revision <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>
    <span style=color:#f92672>}</span>
    javaVersion <span style=color:#f92672>{</span>
        version <span style=color:#f92672>=</span> JavaVersion<span style=color:#f92672>.</span><span style=color:#a6e22e>VERSION_1_8</span>
    <span style=color:#f92672>}</span>
    uniqueRClasses <span style=color:#f92672>{</span>
        enabled <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div></div></div><p>That&rsquo;s all for a configuration. Run it manually to verify that it works:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>./gradlew checkBuildEnvironment
</code></pre></div><p>The plugin will run it automatically on every build.</p><h2 id=configuration>Configuration
<a class=anchor href=#configuration>#</a></h2><h3 id=enable-single-check>Enable single check
<a class=anchor href=#enable-single-check>#</a></h3><div class=book-tabs><input type=radio class=toggle name="tabs-Enable single check" id="tabs-Enable single check-0" checked>
<label for="tabs-Enable single check-0">Kotlin</label><div class="book-tabs-content markdown-inner"><p><code>build.gradle.kts</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>buildChecks {
    enableByDefault = <span style=color:#66d9ef>false</span>

    androidSdk {
        compileSdkVersion = <span style=color:#ae81ff>29</span>
        revision = <span style=color:#ae81ff>5</span>
    }
}
</code></pre></div></div><input type=radio class=toggle name="tabs-Enable single check" id="tabs-Enable single check-1">
<label for="tabs-Enable single check-1">Groovy</label><div class="book-tabs-content markdown-inner"><p><code>build.gradle</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>buildChecks <span style=color:#f92672>{</span>
    enableByDefault <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>

    androidSdk <span style=color:#f92672>{</span>
        compileSdkVersion <span style=color:#f92672>=</span> <span style=color:#ae81ff>29</span>
        revision <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div></div></div><h3 id=disable-single-check>Disable single check
<a class=anchor href=#disable-single-check>#</a></h3><div class=book-tabs><input type=radio class=toggle name="tabs-Disable single check" id="tabs-Disable single check-0" checked>
<label for="tabs-Disable single check-0">Kotlin</label><div class="book-tabs-content markdown-inner"><p><code>build.gradle.kts</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>buildChecks {
    androidSdk {
        enabled = <span style=color:#66d9ef>false</span>
    }
}
</code></pre></div></div><input type=radio class=toggle name="tabs-Disable single check" id="tabs-Disable single check-1">
<label for="tabs-Disable single check-1">Groovy</label><div class="book-tabs-content markdown-inner"><p><code>build.gradle</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>buildChecks <span style=color:#f92672>{</span>
    androidSdk <span style=color:#f92672>{</span>
        enabled <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div></div></div><h3 id=disable-all-checks>Disable all checks
<a class=anchor href=#disable-all-checks>#</a></h3><div class=book-tabs><input type=radio class=toggle name="tabs-Disable all checks" id="tabs-Disable all checks-0" checked>
<label for="tabs-Disable all checks-0">Kotlin</label><div class="book-tabs-content markdown-inner"><p><code>build.gradle.kts</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>buildChecks {
    enableByDefault = <span style=color:#66d9ef>false</span>
}
</code></pre></div></div><input type=radio class=toggle name="tabs-Disable all checks" id="tabs-Disable all checks-1">
<label for="tabs-Disable all checks-1">Groovy</label><div class="book-tabs-content markdown-inner"><p><code>build.gradle</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>buildChecks <span style=color:#f92672>{</span>
    enableByDefault <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>
<span style=color:#f92672>}</span>
</code></pre></div></div></div><h3 id=disable-plugin>Disable plugin
<a class=anchor href=#disable-plugin>#</a></h3><p>To completely disable the plugin add a Gradle property:</p><pre><code class=language-properties data-lang=properties>avito.build-checks.enabled=false
</code></pre><h2 id=checks>Checks
<a class=anchor href=#checks>#</a></h2><h3 id=java-version>Java version
<a class=anchor href=#java-version>#</a></h3><p>The Java version can influence the output of the Java compiler.
It leads to Gradle <a href=https://guides.gradle.org/using-build-cache/#diagnosing_cache_miss>remote cache misses</a>.<br>This check forces the same version for all builds.</p><div class=book-tabs><input type=radio class=toggle name="tabs-Java version" id="tabs-Java version-0" checked>
<label for="tabs-Java version-0">Kotlin</label><div class="book-tabs-content markdown-inner"><p><code>build.gradle.kts</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>buildChecks {
    javaVersion {
        version = JavaVersion.VERSION_1_8
    }   
}
</code></pre></div></div><input type=radio class=toggle name="tabs-Java version" id="tabs-Java version-1">
<label for="tabs-Java version-1">Groovy</label><div class="book-tabs-content markdown-inner"><p><code>build.gradle</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>buildChecks <span style=color:#f92672>{</span>
    javaVersion <span style=color:#f92672>{</span>
        version <span style=color:#f92672>=</span> JavaVersion<span style=color:#f92672>.</span><span style=color:#a6e22e>VERSION_1_8</span>
    <span style=color:#f92672>}</span>   
<span style=color:#f92672>}</span>
</code></pre></div></div></div><h3 id=android-sdk-version>Android SDK version
<a class=anchor href=#android-sdk-version>#</a></h3><p>Android build tools uses android.jar (<code>$ANDROID_HOME/platforms/android-&lt;compileSdkVersion>/android.jar</code>).<br>The version can be specified only without a revision (<a href=https://issuetracker.google.com/issues/117789774>#117789774</a>).
Different revisions lead to Gradle remote cache misses. This check forces the same revision:</p><div class=book-tabs><input type=radio class=toggle name="tabs-Android SDK version" id="tabs-Android SDK version-0" checked>
<label for="tabs-Android SDK version-0">Kotlin</label><div class="book-tabs-content markdown-inner"><p><code>build.gradle.kts</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>buildChecks {
    androidSdk {
        compileSdkVersion = <span style=color:#ae81ff>29</span>
        revision = <span style=color:#ae81ff>5</span>
    }
}
</code></pre></div></div><input type=radio class=toggle name="tabs-Android SDK version" id="tabs-Android SDK version-1">
<label for="tabs-Android SDK version-1">Groovy</label><div class="book-tabs-content markdown-inner"><p><code>build.gradle</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>buildChecks <span style=color:#f92672>{</span>
    androidSdk <span style=color:#f92672>{</span>
        compileSdkVersion <span style=color:#f92672>=</span> <span style=color:#ae81ff>29</span>
        revision <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div></div></div><h3 id=macos-localhost-lookup>macOS localhost lookup
<a class=anchor href=#macos-localhost-lookup>#</a></h3><p>On macOs <code>java.net.InetAddress#getLocalHost()</code> invocation can last up to 5 seconds instead of milliseconds
(<a href=https://thoeni.io/post/macos-sierra-java/>thoeni.io/post/macos-sierra-java</a>).
Gradle has a <a href=https://github.com/gradle/gradle/pull/11134>workaround</a> but it works only inside Gradle&rsquo;s code.</p><p>To diagnose the problem manually use <a href=https://github.com/thoeni/inetTester>thoeni/inetTester</a>.</p><p>To fix the problem use this workaround:</p><ol><li>Find your computer&rsquo;s name - <a href=https://support.apple.com/en-us/guide/mac-help/find-your-computers-name-and-network-address-mchlp1177/mac>Find your computer&rsquo;s name and network address</a></li><li>Add it to <code>/etc/hosts</code> config:</li></ol><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>127.0.0.1        localhost &lt;your_host_name&gt;.local
::1              localhost &lt;your_host_name&gt;.local
</code></pre></div><ol start=3><li>Reboot the computer</li><li>Check again by <a href=https://github.com/thoeni/inetTester>thoeni/inetTester</a></li></ol><p>This check automatically detects the issue:</p><div class=book-tabs><input type=radio class=toggle name=tabs-macOS id=tabs-macOS-0 checked>
<label for=tabs-macOS-0>Kotlin</label><div class="book-tabs-content markdown-inner"><p><code>build.gradle.kts</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>buildChecks {
    macOSLocalhost { }
}
</code></pre></div></div><input type=radio class=toggle name=tabs-macOS id=tabs-macOS-1>
<label for=tabs-macOS-1>Groovy</label><div class="book-tabs-content markdown-inner"><p><code>build.gradle</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>buildChecks <span style=color:#f92672>{</span>
    macOSLocalhost <span style=color:#f92672>{</span> <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div></div></div><h3 id=dynamic-dependency-version>Dynamic dependency version
<a class=anchor href=#dynamic-dependency-version>#</a></h3><p>Dynamic versions, such as &ldquo;2.+&rdquo;, and snapshot versions force Gradle to check them on a remote server.
It slows down a <a href=https://guides.gradle.org/performance/#minimize_dynamic_and_snapshot_versions>configuration time</a>
and makes build <a href=https://reproducible-builds.org/>less reproducible</a>.</p><p>This check forbids dynamic dependency versions.</p><div class=book-tabs><input type=radio class=toggle name="tabs-Dynamic dependency version" id="tabs-Dynamic dependency version-0" checked>
<label for="tabs-Dynamic dependency version-0">Kotlin</label><div class="book-tabs-content markdown-inner"><p><code>build.gradle.kts</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>buildChecks {
    dynamicDependencies { }
}
</code></pre></div></div><input type=radio class=toggle name="tabs-Dynamic dependency version" id="tabs-Dynamic dependency version-1">
<label for="tabs-Dynamic dependency version-1">Groovy</label><div class="book-tabs-content markdown-inner"><p><code>build.gradle</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>buildChecks <span style=color:#f92672>{</span>
    dynamicDependencies <span style=color:#f92672>{</span> <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div></div></div><h3 id=unique-r-classes>Unique R classes
<a class=anchor href=#unique-r-classes>#</a></h3><p>If two Android modules use the same package, their R classes will be merged.
While merging, it can unexpectedly override resources. It happens even with <code>android.namespacedRClass</code>.</p><p>To forbid merged R files use this check:</p><div class=book-tabs><input type=radio class=toggle name="tabs-Unique R classes" id="tabs-Unique R classes-0" checked>
<label for="tabs-Unique R classes-0">Kotlin</label><div class="book-tabs-content markdown-inner"><p><code>build.gradle.kts</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>plugins {
    id(<span style=color:#e6db74>&#34;com.avito.android.buildchecks&#34;</span>)
    id(<span style=color:#e6db74>&#34;com.avito.android.impact&#34;</span>) <span style=color:#75715e>// this check requires impact analysis
</span><span style=color:#75715e></span>}

buildChecks {
    uniqueRClasses { } <span style=color:#75715e>// enabled by default
</span><span style=color:#75715e></span>}
</code></pre></div></div><input type=radio class=toggle name="tabs-Unique R classes" id="tabs-Unique R classes-1">
<label for="tabs-Unique R classes-1">Groovy</label><div class="book-tabs-content markdown-inner"><p><code>build.gradle</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>plugins <span style=color:#f92672>{</span>
    id<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;com.avito.android.buildchecks&#34;</span><span style=color:#f92672>)</span>
    id<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;com.avito.android.impact&#34;</span><span style=color:#f92672>)</span> <span style=color:#75715e>// this check requires impact analysis
</span><span style=color:#75715e></span><span style=color:#f92672>}</span>

buildChecks <span style=color:#f92672>{</span>
    uniqueRClasses <span style=color:#f92672>{</span> <span style=color:#f92672>}</span> <span style=color:#75715e>// enabled by default
</span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</code></pre></div></div></div><h3 id=gradle-daemon-reusage>Gradle daemon reusage
<a class=anchor href=#gradle-daemon-reusage>#</a></h3><p>Gradle can run multiple daemons for <a href=https://docs.gradle.org/5.0/userguide/gradle_daemon.html#sec:why_is_there_more_than_one_daemon_process_on_my_machine>many reasons</a>.</p><p>If you use <code>buildSrc</code> in the project with standalone Gradle wrapper, this check will verify common problems to reuse it.</p><div class=book-tabs><input type=radio class=toggle name="tabs-Gradle daemon reusage" id="tabs-Gradle daemon reusage-0" checked>
<label for="tabs-Gradle daemon reusage-0">Kotlin</label><div class="book-tabs-content markdown-inner"><p><code>build.gradle.kts</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>buildChecks {
    gradleDaemon { }
}
</code></pre></div></div><input type=radio class=toggle name="tabs-Gradle daemon reusage" id="tabs-Gradle daemon reusage-1">
<label for="tabs-Gradle daemon reusage-1">Groovy</label><div class="book-tabs-content markdown-inner"><p><code>build.gradle</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>buildChecks <span style=color:#f92672>{</span>
    gradleDaemon <span style=color:#f92672>{</span> <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div></div></div><h3 id=module-types>Module types
<a class=anchor href=#module-types>#</a></h3><p>This check force to apply <a href=https://github.com/avito-tech/avito-android/blob/develop/subprojects/gradle/module-types><code>module-types</code></a> Gradle plugin in all modules.
It prevents modules go to wrong configurations (android-test module as an app’s implementation dependency for example).</p><div class=book-tabs><input type=radio class=toggle name="tabs-Module types" id="tabs-Module types-0" checked>
<label for="tabs-Module types-0">Kotlin</label><div class="book-tabs-content markdown-inner"><p><code>build.gradle.kts</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>buildChecks {
    moduleTypes { 
        enabled = <span style=color:#66d9ef>true</span> <span style=color:#75715e>// disabled by default
</span><span style=color:#75715e></span>    } 
}
</code></pre></div></div><input type=radio class=toggle name="tabs-Module types" id="tabs-Module types-1">
<label for="tabs-Module types-1">Groovy</label><div class="book-tabs-content markdown-inner"><p><code>build.gradle</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>buildChecks <span style=color:#f92672>{</span>
    moduleTypes <span style=color:#f92672>{</span> 
        enabled <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span> <span style=color:#75715e>// disabled by default
</span><span style=color:#75715e></span>    <span style=color:#f92672>}</span> 
<span style=color:#f92672>}</span>
</code></pre></div></div></div><h3 id=gradle-properties>Gradle properties
<a class=anchor href=#gradle-properties>#</a></h3><blockquote class="book-hint info">This check contains Avito specific details</blockquote><p>This check detects if you override <a href=https://docs.gradle.org/current/userguide/build_environment.html#sec:project_properties>Gradle project property</a> by command-line.
It sends mismatches to <a href=https://avito-tech.github.io/avito-android/docs/analytics/statsd/>statsd</a>.
This information helps to see frequently changed propeties that can lead to remote cache misses.</p><div class=book-tabs><input type=radio class=toggle name="tabs-Gradle properties" id="tabs-Gradle properties-0" checked>
<label for="tabs-Gradle properties-0">Kotlin</label><div class="book-tabs-content markdown-inner"><p><code>build.gradle.kts</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>buildChecks {
    gradleProperties { 
        enabled = <span style=color:#66d9ef>true</span> <span style=color:#75715e>// disabled by default
</span><span style=color:#75715e></span>    } 
}
</code></pre></div></div><input type=radio class=toggle name="tabs-Gradle properties" id="tabs-Gradle properties-1">
<label for="tabs-Gradle properties-1">Groovy</label><div class="book-tabs-content markdown-inner"><p><code>build.gradle</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>buildChecks <span style=color:#f92672>{</span>
    gradleProperties <span style=color:#f92672>{</span> 
        enabled <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span> <span style=color:#75715e>// disabled by default
</span><span style=color:#75715e></span>    <span style=color:#f92672>}</span> 
<span style=color:#f92672>}</span>
</code></pre></div></div></div><h3 id=incremental-kapt>Incremental KAPT
<a class=anchor href=#incremental-kapt>#</a></h3><p>This check verifies that all KAPT annotation processors support incremental annotation processing
if it is <a href=https://kotlinlang.org/docs/reference/kapt.html#incremental-annotation-processing-since-1330>enabled</a> (<code>kapt.incremental.apt=true</code>).
Because if one of them does not support it then whole incremental annotation processing won&rsquo;t work at all.</p><p>Supported processors:</p><ul><li><a href=https://developer.android.com/topic/libraries/architecture/room>Room</a></li></ul><p>Incremental KAPT check has three modes:</p><ul><li><code>"none"</code> &ndash; check is disable</li><li><code>"warning"</code> &ndash; prints warning in build log (default behaviour)</li><li><code>"fail"</code> &ndash; fail whole build</li></ul><div class=book-tabs><input type=radio class=toggle name=tabs- id=tabs--0 checked>
<label for=tabs--0>Kotlin</label><div class="book-tabs-content markdown-inner"><p><code>build.gradle.kts</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>buildChecks {
    incrementalKapt {
        mode = <span style=color:#e6db74>&#34;fail&#34;</span>
    }
}
</code></pre></div></div><input type=radio class=toggle name=tabs- id=tabs--1>
<label for=tabs--1>Groovy</label><div class="book-tabs-content markdown-inner"><p><code>build.gradle</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>buildChecks <span style=color:#f92672>{</span>
    incrementalKapt <span style=color:#f92672>{</span>
        mode <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;fail&#34;</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div></div></div><h4 id=room>Room
<a class=anchor href=#room>#</a></h4><p>Room supports incremental annotation processing if all of the following conditions are met:</p><ul><li><a href=https://developer.android.com/jetpack/androidx/releases/room#compiler-options><code>room.incremental</code></a> it set to <code>true</code>
or <code>com.avito.android.room-config</code> Gradle-plugin is applied</li><li>You use Java 11 and higher or use JDK embedded in Android Studio 3.5.0-beta02 and higher.
For more info about these restrictions read the documentation for the method <code>methodParametersVisibleInClassFiles</code>
in <code>RoomProcessor</code> <a href=https://android.googlesource.com/platform/frameworks/support/+/refs/heads/androidx-master-dev/room/compiler/src/main/kotlin/androidx/room/RoomProcessor.kt>sources</a></li></ul><p>If you use IntelliJ IDEA or build a project from the command line you have to set up <code>JAVA_HOME</code> environment variable to
reference the path to embedded JDK in Android Studio. You can add to <code>~/.gradle/gradle.properties</code> line like this:</p><pre><code class=language-properties data-lang=properties>org.gradle.java.home=/Applications/Android Studio.app/Contents/jre/jdk/Contents/Home
</code></pre><p>This path can be retrieved from <strong>Project Structure > SDK Location > JDK location</strong> in
Android Studio.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div class=book-languages tabindex=0 aria-haspopup=true><ul><li class="flex align-center"><img src=/avito-android/svg/translate.svg class=book-icon alt=Languages>
English</li></ul><ul class=book-languages-list><li class=active><a href=https://avito-tech.github.io/avito-android/ class="flex align-center"><img src=/avito-android/svg/translate.svg class=book-icon alt=Languages>
English</a></li><li><a href=https://avito-tech.github.io/avito-android/ru/ class="flex align-center"><img src=/avito-android/svg/translate.svg class=book-icon alt=Languages>
Русский</a></li></ul></div><div><a class="flex align-center" href=https://github.com/avito-tech/avito-android/tree/develop/docs/content//docs/projects/BuildChecks.md target=_blank rel=noopener><img src=/avito-android/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#getting-started>Getting started</a></li><li><a href=#configuration>Configuration</a><ul><li><a href=#enable-single-check>Enable single check</a></li><li><a href=#disable-single-check>Disable single check</a></li><li><a href=#disable-all-checks>Disable all checks</a></li><li><a href=#disable-plugin>Disable plugin</a></li></ul></li><li><a href=#checks>Checks</a><ul><li><a href=#java-version>Java version</a></li><li><a href=#android-sdk-version>Android SDK version</a></li><li><a href=#macos-localhost-lookup>macOS localhost lookup</a></li><li><a href=#dynamic-dependency-version>Dynamic dependency version</a></li><li><a href=#unique-r-classes>Unique R classes</a></li><li><a href=#gradle-daemon-reusage>Gradle daemon reusage</a></li><li><a href=#module-types>Module types</a></li><li><a href=#gradle-properties>Gradle properties</a></li><li><a href=#incremental-kapt>Incremental KAPT</a><ul><li><a href=#room>Room</a></li></ul></li></ul></li></ul></nav></aside></main></body></html>